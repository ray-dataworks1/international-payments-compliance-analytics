version: 2

models:
  - name: dim_customer_risk_profiles
    description: >
      Dimension-like model aggregating customer, account, and currency data
      to produce derived risk scores per entity.
    columns:
      - name: customer_id
        tests: [not_null]
          customer_id,
      - name: currency_id
        tests: [not_null]
      - name: currency_code
        tests: [not_null]
      - name: currency_name
        tests: [not_null]
      - name: kyc_status
        tests: [not_null]
      - name: country_of_residence
        tests: [not_null]
      - name: is_active
        tests: [not_null]
      - name: kyc_risk_score
        tests: 
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 5
      - name: customer_review_risk_score
        tests:
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 5
      - name: country_risk_score
        tests:
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 5
      - name: account_active_risk_score
        tests:
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 5
      - name: account_review_risk_score
        tests:
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 5
      - name: total_risk_percentage
        tests:
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 100

  - name: fct_compliance_risk_metrics
    description: >
      Daily snapshot of compliance-level risk KPIs derived from
      dim_customer_risk_profiles.
    columns:
      - name: snapshot_date
        tests: [not_null, unique]
      - name: avg_total_risk
        tests: [not_null]
      - name: high_risk_customers
        tests: [not_null]
      - name: kyc_pending
        tests: [not_null]
      - name: high_risk_country_customers
        tests: [not_null]
      - name: total_customers
        tests: [not_null]
      - name: pct_high_risk
        tests:
          - not_null
          - accepted_range:
              min_value: 0
              max_value: 100